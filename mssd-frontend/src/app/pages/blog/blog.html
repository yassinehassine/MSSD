<!-- Blog Page Content -->
<div class="page-title">
  <div class="heading">
    <div class="container">
      <div class="row d-flex justify-content-center text-center">
        <div class="col-lg-8">
          <h1>Blog</h1>
          <p class="mb-0">Découvrez nos événements passés et nos réalisations</p>
        </div>
      </div>
    </div>
  </div>
  <nav class="breadcrumbs">
    <div class="container">
      <ol>
        <li><a routerLink="/">Home</a></li>
        <li class="current">Blog</li>
      </ol>
    </div>
  </nav>
</div><!-- End Page Title -->

<div class="container">
  <section id="blog-section" class="blog section">

    <!-- Loading Spinner -->
    <div *ngIf="loading" class="text-center py-5">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Chargement...</span>
      </div>
      <p class="mt-3 text-muted">Chargement des articles...</p>
    </div>

    <!-- Error Message -->
    <div *ngIf="error" class="alert alert-danger" role="alert">
      <i class="bi bi-exclamation-triangle me-2"></i>
      {{ error }}
    </div>

    <!-- Search and Filter Controls -->
    <div *ngIf="!loading && !error && blogs.length > 0" class="search-filter-section mb-4">
      <div class="card">
        <div class="card-body">
          <div class="row g-3">
            <!-- Search -->
            <div class="col-md-6">
              <label for="search" class="form-label">
                <i class="bi bi-search me-1"></i>Rechercher
              </label>
              <input 
                type="text" 
                id="search"
                class="form-control" 
                placeholder="Rechercher par titre ou description..."
                [(ngModel)]="searchTerm"
                (input)="onSearchChange()">
            </div>
            
            <!-- Sort -->
            <div class="col-md-3">
              <label for="sort" class="form-label">
                <i class="bi bi-sort-down me-1"></i>Trier par
              </label>
              <select 
                id="sort"
                class="form-select" 
                [(ngModel)]="sortBy"
                (change)="onSortChange()">
                <option value="date">Date (plus récent)</option>
                <option value="title">Titre (A-Z)</option>
                <option value="type">Type</option>
              </select>
            </div>
            
            <!-- Filter -->
            <div class="col-md-3">
              <label for="filter" class="form-label">
                <i class="bi bi-funnel me-1"></i>Filtrer
              </label>
              <select 
                id="filter"
                class="form-select" 
                [(ngModel)]="filterType"
                (change)="onFilterChange()">
                <option value="all">Tous les articles</option>
                <option value="video">Vidéos seulement</option>
                <option value="image">Images seulement</option>
                <option value="text">Texte seulement</option>
              </select>
            </div>
          </div>
          
          <!-- Results Counter -->
          <div class="mt-3 text-muted">
            <small>
              <i class="bi bi-info-circle me-1"></i>
              {{ totalItems }} article(s) trouvé(s)
              <span *ngIf="searchTerm"> pour "{{ searchTerm }}"</span>
            </small>
          </div>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="!loading && !error && blogs.length === 0" class="text-center py-5">
      <i class="bi bi-journal-x display-1 text-muted mb-3"></i>
      <h4 class="text-muted">Aucun article disponible</h4>
      <p class="text-muted">Les articles de blog seront bientôt disponibles.</p>
    </div>
    
    <!-- No Results -->
    <div *ngIf="!loading && !error && blogs.length > 0 && filteredBlogs.length === 0" class="text-center py-5">
      <i class="bi bi-search display-1 text-muted mb-3"></i>
      <h4 class="text-muted">Aucun résultat trouvé</h4>
      <p class="text-muted">Essayez de modifier vos critères de recherche.</p>
      <button class="btn btn-outline-primary" (click)="searchTerm = ''; filterType = 'all'; onSearchChange()">
        <i class="bi bi-arrow-clockwise me-2"></i>Réinitialiser
      </button>
    </div>

    <!-- Blog Articles -->
    <div *ngIf="!loading && !error && paginatedBlogs.length > 0" class="row gy-4">
      <div class="col-lg-4 col-md-6" *ngFor="let blog of paginatedBlogs" data-aos="fade-up">
        <article class="blog-card h-100" [class.video-blog]="blog.youtubeUrl" (click)="onBlogClick(blog)">

          <!-- Media Content - Only Images -->
          <div class="post-media" *ngIf="!blog.youtubeUrl && blog.imageUrl">
            <!-- Image (only for non-video blogs) -->
            <div class="post-img">
              <img 
                [src]="getImageUrl(blog)" 
                [alt]="blog.title" 
                class="img-fluid"
                onerror="this.src='assets/img/blog/blog-default.jpg'">
            </div>
          </div>

          <!-- Content -->
          <div class="post-content">
            <div class="post-meta">
              <span class="post-date">
                <i class="bi bi-calendar me-1"></i>
                {{ formatDate(blog.publishDate!) }}
              </span>
              <span *ngIf="hasMedia(blog)" class="post-media-indicator">
                <i *ngIf="blog.youtubeUrl" class="bi bi-youtube text-danger me-1"></i>
                <i *ngIf="blog.imageUrl && !blog.youtubeUrl" class="bi bi-image text-info me-1"></i>
              </span>
            </div>

            <h3 class="post-title">
              {{ blog.title }}
            </h3>

            <p class="post-excerpt">
              {{ blog.description.length > 150 ? (blog.description | slice:0:150) + '...' : blog.description }}
            </p>

            <!-- Read More / Watch Video -->
            <div class="post-actions">
              <button *ngIf="blog.youtubeUrl" class="btn btn-outline-danger btn-sm" (click)="openYouTubeVideo(blog.youtubeUrl!, $event)">
                <i class="bi bi-youtube me-1"></i>
                Voir sur YouTube
              </button>
              <button *ngIf="!blog.youtubeUrl" class="btn btn-outline-primary btn-sm">
                <i class="bi bi-arrow-right me-1"></i>
                Lire Plus
              </button>
            </div>
          </div>

        </article>
      </div><!-- End blog item -->
    </div>

    <!-- Pagination -->
    <app-pagination 
      *ngIf="!loading && !error && totalItems > itemsPerPage"
      [currentPage]="currentPage"
      [totalItems]="totalItems"
      [itemsPerPage]="itemsPerPage"
      (pageChange)="onPageChange($event)"
      class="mt-5">
    </app-pagination>

  </section>
</div>
