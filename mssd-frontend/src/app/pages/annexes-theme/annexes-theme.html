<!-- Hero Header -->
<section class="theme-hero" *ngIf="!loading && !error && theme">
  <div class="container">
    <nav class="breadcrumb-nav" aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item">
          <a routerLink="/home"><i class="bi bi-house-fill"></i> Accueil</a>
        </li>
        <li class="breadcrumb-item">
          <a routerLink="/annexes"><i class="bi bi-collection-fill"></i> Formations</a>
        </li>
        <li class="breadcrumb-item active" aria-current="page">
          {{ theme.name || slug }}
        </li>
      </ol>
    </nav>

    <div class="hero-content">
      <div class="hero-text">
        <h1 class="hero-title">{{ theme.name }}</h1>
        <p class="hero-subtitle">{{ theme.description || 'Découvrez nos formations dans ce domaine.' }}</p>
        <div class="hero-stats">
          <div class="hero-stat">
            <i class="bi bi-mortarboard-fill"></i>
            <span>{{ theme.formations?.length || 0 }} formations</span>
          </div>
        </div>
      </div>
      <div class="hero-action">
        <button class="btn-request-hero" (click)="goRequest()">
          <i class="bi bi-send-fill"></i>
          <span>Demander une formation</span>
        </button>
      </div>
    </div>
  </div>
</section>

<!-- Loading State -->
<section class="loading-section" *ngIf="loading">
  <div class="container">
    <div class="loading-state">
      <div class="spinner"></div>
      <p>Chargement du thème...</p>
    </div>
  </div>
</section>

<!-- Error State -->
<section class="error-section" *ngIf="error && !loading">
  <div class="container">
    <div class="error-state">
      <i class="bi bi-exclamation-triangle-fill"></i>
      <h4>Erreur</h4>
      <p>{{ error }}</p>
      <a routerLink="/annexes" class="btn-back-error">
        <i class="bi bi-arrow-left"></i> Retour aux formations
      </a>
    </div>
  </div>
</section>

<!-- Formations Grid -->
<section class="formations-section" *ngIf="!loading && !error && theme">
  <div class="container">
    <div class="section-header">
      <h2 class="section-title">
        <span class="title-icon"><i class="bi bi-grid-3x3-gap-fill"></i></span>
        Formations disponibles
      </h2>
      <span class="formations-count">{{ theme.formations?.length || 0 }} résultats</span>
    </div>

    <div *ngIf="theme.formations?.length; else noFormations" class="formations-grid">
      <div *ngFor="let f of theme.formations; let i = index" 
           class="formation-card"
           [style.animation-delay]="i * 0.1 + 's'">
        <div class="card-gradient-border"></div>
        <div class="card-inner">
          <div class="card-top">
            <span [class]="'level-badge level-' + f.level.toLowerCase()">
              <i class="bi" [ngClass]="{
                'bi-star': f.level === 'BEGINNER',
                'bi-star-half': f.level === 'INTERMEDIATE',
                'bi-stars': f.level === 'EXPERT'
              }"></i>
              {{ levelLabel(f.level) }}
            </span>
            <span class="card-price">{{ f.price | currency:'EUR':'symbol':'1.0-0' }}</span>
          </div>

          <h3 class="card-title">{{ f.title }}</h3>
          <p class="card-description">{{ f.description }}</p>

          <div class="card-meta">
            <div class="meta-item">
              <i class="bi bi-clock-fill"></i>
              <span>{{ f.duration }}</span>
            </div>
            <div class="meta-item">
              <i class="bi bi-bar-chart-fill"></i>
              <span>{{ levelLabel(f.level) }}</span>
            </div>
          </div>

          <button class="btn-view-details" (click)="viewFormationDetails(f)">
            <span>Voir les détails</span>
            <i class="bi bi-arrow-right"></i>
          </button>
        </div>
      </div>
    </div>

    <ng-template #noFormations>
      <div class="empty-state">
        <div class="empty-icon">
          <i class="bi bi-inbox"></i>
        </div>
        <h4>Aucune formation disponible</h4>
        <p>Les formations dans ce thème seront bientôt disponibles.</p>
        <a routerLink="/annexes" class="btn-back">
          <i class="bi bi-arrow-left"></i> Retour au catalogue
        </a>
      </div>
    </ng-template>
  </div>
</section>

<!-- Formation Details Modal -->
<div class="modal-overlay" *ngIf="showFormationModal" (click)="closeFormationModal()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <div class="modal-hero">
      <div class="modal-hero-bg"></div>
      <button class="modal-close" (click)="closeFormationModal()">
        <i class="bi bi-x-lg"></i>
      </button>
      <div class="modal-hero-content" *ngIf="selectedFormation">
        <span [class]="'modal-level-badge level-' + selectedFormation.level.toLowerCase()">
          {{ levelLabel(selectedFormation.level) }}
        </span>
        <h2 class="modal-title">{{ selectedFormation.title }}</h2>
      </div>
    </div>

    <div class="modal-body" *ngIf="selectedFormation">
      <div class="modal-info-grid">
        <div class="info-card">
          <div class="info-card-icon price">
            <i class="bi bi-currency-euro"></i>
          </div>
          <div class="info-card-content">
            <span class="info-label">Prix</span>
            <span class="info-value">{{ selectedFormation.price | currency:'EUR':'symbol':'1.0-0' }}</span>
          </div>
        </div>
        <div class="info-card">
          <div class="info-card-icon duration">
            <i class="bi bi-clock-fill"></i>
          </div>
          <div class="info-card-content">
            <span class="info-label">Durée</span>
            <span class="info-value">{{ selectedFormation.duration }}</span>
          </div>
        </div>
        <div class="info-card">
          <div class="info-card-icon level">
            <i class="bi bi-bar-chart-fill"></i>
          </div>
          <div class="info-card-content">
            <span class="info-label">Niveau</span>
            <span class="info-value">{{ levelLabel(selectedFormation.level) }}</span>
          </div>
        </div>
        <div class="info-card" *ngIf="theme">
          <div class="info-card-icon category">
            <i class="bi bi-bookmark-fill"></i>
          </div>
          <div class="info-card-content">
            <span class="info-label">Thème</span>
            <span class="info-value">{{ theme.name }}</span>
          </div>
        </div>
      </div>

      <div class="modal-description" *ngIf="selectedFormation.description">
        <h4><i class="bi bi-text-paragraph"></i> Description</h4>
        <p>{{ selectedFormation.description }}</p>
      </div>

      <div class="modal-image" *ngIf="selectedFormation.imageUrl">
        <img [src]="getImageUrl(selectedFormation.imageUrl)" 
             [alt]="selectedFormation.title" 
             class="formation-image">
      </div>

      <div class="modal-cta">
        <div class="cta-icon">
          <i class="bi bi-lightbulb-fill"></i>
        </div>
        <div class="cta-text">
          <h5>Cette formation vous intéresse ?</h5>
          <p>Contactez-nous pour obtenir plus d'informations ou pour planifier cette formation sur mesure.</p>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn-request" (click)="requestFormation(selectedFormation)">
        <i class="bi bi-send-fill"></i>
        Demander cette formation
      </button>
      <button class="btn-close-modal" (click)="closeFormationModal()">
        Fermer
      </button>
    </div>
  </div>
</div>
