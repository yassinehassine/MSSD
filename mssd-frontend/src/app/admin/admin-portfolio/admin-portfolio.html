<div class="admin-portfolio-container">
  <div class="header-section">
    <h1><i class="fas fa-briefcase me-2"></i>Gestion Portfolio</h1>
    <button class="btn btn-primary" (click)="showAddForm()" [disabled]="isLoading">
      <i class="fas fa-plus me-2"></i>Ajouter un élément
    </button>
  </div>

  <!-- Loading Spinner -->
  <div *ngIf="isLoading" class="text-center py-4">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Chargement...</span>
    </div>
  </div>

  <!-- Message Alert -->
  <div *ngIf="message" class="alert" [class]="'alert-' + (messageType === 'success' ? 'success' : 'danger')" role="alert">
    <i class="fas" [class]="messageType === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'"></i>
    {{ message }}
  </div>

  <!-- Form Modal -->
  <div class="modal fade" [class.show]="showForm" [style.display]="showForm ? 'block' : 'none'" *ngIf="showForm">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">
            <i class="fas fa-edit me-2"></i>
            {{ isEditing ? 'Modifier' : 'Ajouter' }} un élément portfolio
          </h5>
          <button type="button" class="btn-close" (click)="cancelForm()"></button>
        </div>
        <div class="modal-body">
          <form (ngSubmit)="saveItem()" #portfolioForm="ngForm">
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="companyName" class="form-label">Nom de l'entreprise *</label>
                <input 
                  type="text" 
                  class="form-control" 
                  id="companyName"
                  [(ngModel)]="currentItem.companyName"
                  name="companyName"
                  required
                  placeholder="Ex: TechCorp Solutions">
              </div>
              <div class="col-md-6 mb-3">
                <label for="trainingTitle" class="form-label">Titre de la formation *</label>
                <input 
                  type="text" 
                  class="form-control" 
                  id="trainingTitle"
                  [(ngModel)]="currentItem.trainingTitle"
                  name="trainingTitle"
                  required
                  placeholder="Ex: Leadership & Management">
              </div>
            </div>

            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="trainingDate" class="form-label">Date de la formation *</label>
                <input 
                  type="date" 
                  class="form-control" 
                  id="trainingDate"
                  [(ngModel)]="currentItem.trainingDate"
                  name="trainingDate"
                  required>
              </div>
              <div class="col-md-6 mb-3">
                <label for="logoFile" class="form-label">Logo de l'entreprise</label>
                <input 
                  type="file" 
                  class="form-control" 
                  id="logoFile"
                  accept="image/*"
                  (change)="onFileSelected($event)">
                <small class="form-text text-muted">Formats acceptés: JPG, PNG, SVG</small>
              </div>
            </div>

            <div class="mb-3">
              <label for="description" class="form-label">Description (optionnel)</label>
              <textarea 
                class="form-control" 
                id="description"
                [(ngModel)]="currentItem.description"
                name="description"
                rows="3"
                placeholder="Description de la formation ou du projet..."></textarea>
            </div>

            <div class="mb-3 form-check">
              <input 
                type="checkbox" 
                class="form-check-input" 
                id="active"
                [(ngModel)]="currentItem.active"
                name="active">
              <label class="form-check-label" for="active">
                Élément actif (visible sur le site)
              </label>
            </div>

            <!-- Current Logo Preview -->
            <div *ngIf="currentItem.logoUrl && !selectedFile" class="mb-3">
              <label class="form-label">Logo actuel:</label>
              <div class="current-logo-preview">
                <img [src]="getImageUrl(currentItem.logoUrl)" [alt]="currentItem.companyName" class="img-thumbnail" style="max-width: 100px;">
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="cancelForm()" [disabled]="isLoading">
            Annuler
          </button>
          <button type="button" class="btn btn-primary" (click)="saveItem()" [disabled]="isLoading">
            <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2"></span>
            {{ isEditing ? 'Mettre à jour' : 'Créer' }}
          </button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal-backdrop fade" [class.show]="showForm" *ngIf="showForm"></div>

  <!-- Portfolio Items Table -->
  <div class="card">
    <div class="card-header">
      <h5 class="card-title mb-0">
        <i class="fas fa-list me-2"></i>
        Éléments du Portfolio ({{ portfolioItems.length }})
      </h5>
    </div>
    <div class="card-body">
      <div *ngIf="portfolioItems.length === 0 && !isLoading" class="text-center py-4">
        <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
        <p class="text-muted">Aucun élément portfolio trouvé.</p>
        <button class="btn btn-primary" (click)="showAddForm()">
          <i class="fas fa-plus me-2"></i>Ajouter le premier élément
        </button>
      </div>

      <div class="table-responsive" *ngIf="portfolioItems.length > 0">
        <table class="table table-hover">
          <thead class="table-dark">
            <tr>
              <th>Logo</th>
              <th>Entreprise</th>
              <th>Formation</th>
              <th>Date</th>
              <th>Statut</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of portfolioItems" [class.table-secondary]="!item.active">
              <td>
                <div class="logo-cell">
                  <img 
                    [src]="getImageUrl(item.logoUrl)" 
                    [alt]="item.companyName"
                    class="company-logo-preview"
                    onerror="this.src='assets/img/logo1.png'">
                </div>
              </td>
              <td>
                <strong>{{ item.companyName }}</strong>
                <div *ngIf="item.description" class="small text-muted">
                  {{ item.description | slice:0:50 }}<span *ngIf="item.description && item.description.length > 50">...</span>
                </div>
              </td>
              <td>{{ item.trainingTitle }}</td>
              <td>{{ item.trainingDate | date:'dd/MM/yyyy' }}</td>
              <td>
                <span class="badge" [class]="item.active ? 'bg-success' : 'bg-secondary'">
                  {{ item.active ? 'Actif' : 'Inactif' }}
                </span>
              </td>
              <td>
                <div class="btn-group" role="group">
                  <button 
                    class="btn btn-sm btn-outline-primary" 
                    (click)="editItem(item)"
                    [disabled]="isLoading"
                    title="Modifier">
                    <i class="fas fa-edit"></i>
                  </button>
                  <button 
                    class="btn btn-sm" 
                    [class]="item.active ? 'btn-outline-warning' : 'btn-outline-success'"
                    (click)="toggleActive(item)"
                    [disabled]="isLoading"
                    [title]="item.active ? 'Désactiver' : 'Activer'">
                    <i class="fas" [class]="item.active ? 'fa-eye-slash' : 'fa-eye'"></i>
                  </button>
                  <button 
                    class="btn btn-sm btn-outline-danger" 
                    (click)="deleteItem(item)"
                    [disabled]="isLoading"
                    title="Supprimer">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>