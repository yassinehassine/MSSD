<!-- Admin Portfolio Management -->
<div class="container-fluid px-4">
    <h1 class="mt-4">Portfolio Management</h1>
    <ol class="breadcrumb mb-4">
        <li class="breadcrumb-item"><a routerLink="/admin">Dashboard</a></li>
        <li class="breadcrumb-item active">Portfolio</li>
    </ol>

    <!-- Add New Portfolio Button -->
    <div class="card mb-4" *ngIf="!isEditing">
        <div class="card-header">
            <i class="fas fa-plus me-1"></i>
            Portfolio Items
            <button class="btn btn-primary btn-sm float-end" (click)="startEdit()">
                <i class="fas fa-plus"></i> Add New Portfolio Item
            </button>
        </div>
        
        <!-- Portfolio List -->
        <div class="card-body">
            <div *ngIf="isLoading" class="text-center">
                <div class="spinner-border" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
            </div>

            <div class="table-responsive" *ngIf="!isLoading">
                <table class="table table-striped table-bordered">
                    <thead class="table-dark">
                        <tr>
                            <th>Image</th>
                            <th>Title</th>
                            <th>Formation</th>
                            <th>Client</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let portfolio of portfolios">
                            <td>
                                <img [src]="getImageUrl(portfolio.imageUrl)" 
                                     [alt]="portfolio.title" 
                                     class="portfolio-image"
                                     (error)="onImageError($event)"
                                     style="width: 100px; height: 80px; object-fit: cover; border: 1px solid #ddd; border-radius: 4px;">
                                <div class="text-muted small mt-1" style="font-size: 10px; word-break: break-all;">
                                    {{ getImageUrl(portfolio.imageUrl) }}
                                </div>
                            </td>
                            <td>{{ portfolio.title }}</td>
                            <td>
                                <span class="badge bg-info">{{ portfolio.formationName }}</span>
                            </td>
                            <td>{{ portfolio.clientName }}</td>
                            <td>
                                <span class="badge" 
                                      [class.bg-success]="portfolio.active" 
                                      [class.bg-secondary]="!portfolio.active">
                                    {{ portfolio.active ? 'Active' : 'Inactive' }}
                                </span>
                            </td>
                            <td>
                                <button class="btn btn-sm btn-outline-primary me-1" 
                                        (click)="startEdit(portfolio)" title="Edit">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm me-1"
                                        [class.btn-outline-success]="!portfolio.active"
                                        [class.btn-outline-secondary]="portfolio.active"
                                        (click)="toggleActive(portfolio)" 
                                        [title]="portfolio.active ? 'Deactivate' : 'Activate'">
                                    <i class="fas" [class.fa-eye]="!portfolio.active" [class.fa-eye-slash]="portfolio.active"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-danger" 
                                        (click)="confirmDelete(portfolio)" title="Delete">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <div *ngIf="portfolios.length === 0" class="text-center text-muted py-4">
                    <i class="fas fa-folder-open fa-3x mb-3"></i>
                    <p>No portfolio items found. Add your first portfolio item!</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Portfolio Form -->
    <div class="card mb-4" *ngIf="isEditing">
        <div class="card-header">
            <i class="fas fa-edit me-1"></i>
            {{ selectedPortfolio ? 'Edit Portfolio Item' : 'Add New Portfolio Item' }}
        </div>
        <div class="card-body">
            <form (ngSubmit)="savePortfolio()" #portfolioFormRef="ngForm">
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="title" class="form-label">Title *</label>
                            <input type="text" class="form-control" id="title" 
                                   [(ngModel)]="portfolioForm.title" name="title" required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="formation" class="form-label">Formation *</label>
                            <select class="form-control" id="formation" 
                                    [(ngModel)]="portfolioForm.formationId" name="formation" required>
                                <option [value]="0">Select Formation</option>
                                <option *ngFor="let formation of formations" [value]="formation.id">
                                    {{formation.title}}
                                </option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="clientName" class="form-label">Client Name</label>
                            <input type="text" class="form-control" id="clientName" 
                                   [(ngModel)]="portfolioForm.clientName" name="clientName">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="projectDate" class="form-label">Project Date</label>
                            <input type="date" class="form-control" id="projectDate" 
                                   [(ngModel)]="portfolioForm.projectDate" name="projectDate">
                        </div>
                    </div>
                </div>

                <div class="mb-3">
                    <label for="description" class="form-label">Description</label>
                    <textarea class="form-control" id="description" rows="3"
                              [(ngModel)]="portfolioForm.description" name="description"></textarea>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="imageFile" class="form-label">Portfolio Image</label>
                            <input type="file" class="form-control" id="imageFile" 
                                   accept="image/*" (change)="onFileSelected($event)">
                            <div *ngIf="isUploading" class="text-info small mt-1">Uploading...</div>
                            <div *ngIf="portfolioForm.imageUrl && !isUploading" class="mt-2">
                                <div class="mb-2">
                                    <strong>Current Image:</strong>
                                </div>
                                <img [src]="getImageUrl(portfolioForm.imageUrl)" 
                                     [alt]="portfolioForm.title || 'Portfolio image'" 
                                     class="img-thumbnail"
                                     (error)="onImageError($event)"
                                     style="max-width: 300px; max-height: 200px; border: 2px solid #ddd; border-radius: 8px;">
                                <div class="text-muted small mt-1" style="word-break: break-all;">
                                    <strong>URL:</strong> {{ getImageUrl(portfolioForm.imageUrl) }}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="projectUrl" class="form-label">Project URL</label>
                            <input type="url" class="form-control" id="projectUrl" 
                                   [(ngModel)]="portfolioForm.projectUrl" name="projectUrl"
                                   placeholder="https://project-website.com">
                        </div>
                    </div>
                </div>

                <div class="mb-3">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="active" 
                               [(ngModel)]="portfolioForm.active" name="active">
                        <label class="form-check-label" for="active">
                            Active (visible on website)
                        </label>
                    </div>
                </div>

                <div class="d-flex gap-2">
                    <button type="submit" class="btn btn-primary" [disabled]="isLoading || !portfolioFormRef.valid">
                        <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2"></span>
                        <i class="fas fa-save me-1"></i>
                        {{ selectedPortfolio ? 'Update' : 'Create' }}
                    </button>
                    <button type="button" class="btn btn-secondary" (click)="cancelEdit()">
                        <i class="fas fa-times me-1"></i>
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade show" *ngIf="showDeleteConfirm" style="display: block; background: rgba(0,0,0,0.5);">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Confirm Delete</h5>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete <strong>{{ portfolioToDelete?.title }}</strong>?</p>
                <p class="text-danger">This action cannot be undone.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" (click)="cancelDelete()">Cancel</button>
                <button type="button" class="btn btn-danger" (click)="deletePortfolio()">
                    <i class="fas fa-trash me-1"></i>
                    Delete
                </button>
            </div>
        </div>
    </div>
</div>
