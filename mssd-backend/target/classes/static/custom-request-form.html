<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom Request Form - MSSD</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .form-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            padding: 40px;
            margin: 40px auto;
            max-width: 800px;
        }
        .form-header {
            text-align: center;
            margin-bottom: 30px;
        }
        .form-header h1 {
            color: #333;
            font-weight: 700;
        }
        .form-header p {
            color: #666;
            font-size: 1.1rem;
        }
        .form-label {
            font-weight: 600;
            color: #333;
        }
        .form-control:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }
        .btn-submit {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            padding: 12px 30px;
            font-weight: 600;
            border-radius: 10px;
        }
        .btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        .progress-bar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .step-indicator {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
        }
        .step {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e9ecef;
            color: #6c757d;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 10px;
            font-weight: bold;
        }
        .step.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .step.completed {
            background: #28a745;
            color: white;
        }
        .form-step {
            display: none;
        }
        .form-step.active {
            display: block;
        }
        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
        .success-message {
            text-align: center;
            padding: 40px;
        }
        .success-message i {
            font-size: 4rem;
            color: #28a745;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="form-container">
            <!-- Progress Indicator -->
            <div class="step-indicator">
                <div class="step active" id="step1">1</div>
                <div class="step" id="step2">2</div>
                <div class="step" id="step3">3</div>
            </div>

            <!-- Form Header -->
            <div class="form-header">
                <h1><i class="fas fa-tasks"></i> Custom Request Form</h1>
                <p>Tell us about your project requirements and we'll get back to you soon!</p>
            </div>

            <!-- Step 1: Company Information -->
            <div class="form-step active" id="step1Content">
                <h4 class="mb-4">Company Information</h4>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="companyName" class="form-label">Company Name *</label>
                        <input type="text" class="form-control" id="companyName" required>
                        <div class="invalid-feedback">Please provide your company name.</div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="contactPerson" class="form-label">Contact Person *</label>
                        <input type="text" class="form-control" id="contactPerson" required>
                        <div class="invalid-feedback">Please provide the contact person name.</div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="email" class="form-label">Email Address *</label>
                        <input type="email" class="form-control" id="email" required>
                        <div class="invalid-feedback">Please provide a valid email address.</div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="phone" class="form-label">Phone Number</label>
                        <input type="tel" class="form-control" id="phone">
                    </div>
                </div>
            </div>

            <!-- Step 2: Project Details -->
            <div class="form-step" id="step2Content">
                <h4 class="mb-4">Project Details</h4>
                <div class="mb-3">
                    <label for="subject" class="form-label">Project Subject *</label>
                    <input type="text" class="form-control" id="subject" required>
                    <div class="invalid-feedback">Please provide a project subject.</div>
                </div>
                <div class="mb-3">
                    <label for="details" class="form-label">Project Details *</label>
                    <textarea class="form-control" id="details" rows="6" required placeholder="Please describe your project requirements, goals, and any specific features you need..."></textarea>
                    <div class="invalid-feedback">Please provide project details.</div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="budget" class="form-label">Budget (USD)</label>
                        <input type="number" class="form-control" id="budget" min="0" step="0.01" placeholder="Enter your budget">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="preferredStartDate" class="form-label">Preferred Start Date</label>
                        <input type="date" class="form-control" id="preferredStartDate">
                    </div>
                </div>
            </div>

            <!-- Step 3: Review and Submit -->
            <div class="form-step" id="step3Content">
                <h4 class="mb-4">Review Your Request</h4>
                <div class="card">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6>Company Information</h6>
                                <p><strong>Company:</strong> <span id="reviewCompany"></span></p>
                                <p><strong>Contact:</strong> <span id="reviewContact"></span></p>
                                <p><strong>Email:</strong> <span id="reviewEmail"></span></p>
                                <p><strong>Phone:</strong> <span id="reviewPhone"></span></p>
                            </div>
                            <div class="col-md-6">
                                <h6>Project Information</h6>
                                <p><strong>Subject:</strong> <span id="reviewSubject"></span></p>
                                <p><strong>Budget:</strong> <span id="reviewBudget"></span></p>
                                <p><strong>Start Date:</strong> <span id="reviewStartDate"></span></p>
                            </div>
                        </div>
                        <div class="mt-3">
                            <h6>Project Details</h6>
                            <p id="reviewDetails"></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Success Message -->
            <div class="form-step" id="successContent">
                <div class="success-message">
                    <i class="fas fa-check-circle"></i>
                    <h3>Request Submitted Successfully!</h3>
                    <p>Thank you for your custom request. We have received your submission and will review it shortly.</p>
                    <p><strong>Request ID:</strong> <span id="requestId"></span></p>
                    <p>We'll contact you at <span id="submittedEmail"></span> within 24-48 hours.</p>
                    <button class="btn btn-primary" onclick="resetForm()">Submit Another Request</button>
                </div>
            </div>

            <!-- Navigation Buttons -->
            <div class="navigation-buttons" id="navigationButtons">
                <button class="btn btn-secondary" id="prevBtn" onclick="previousStep()" style="display: none;">
                    <i class="fas fa-arrow-left"></i> Previous
                </button>
                <button class="btn btn-primary" id="nextBtn" onclick="nextStep()">
                    Next <i class="fas fa-arrow-right"></i>
                </button>
                <button class="btn btn-submit text-white" id="submitBtn" onclick="submitRequest()" style="display: none;">
                    <i class="fas fa-paper-plane"></i> Submit Request
                </button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let currentStep = 1;
        const totalSteps = 3;

        function nextStep() {
            if (validateCurrentStep()) {
                if (currentStep < totalSteps) {
                    currentStep++;
                    updateStepDisplay();
                }
            }
        }

        function previousStep() {
            if (currentStep > 1) {
                currentStep--;
                updateStepDisplay();
            }
        }

        function updateStepDisplay() {
            // Update step indicators
            for (let i = 1; i <= totalSteps; i++) {
                const stepElement = document.getElementById(`step${i}`);
                if (i < currentStep) {
                    stepElement.className = 'step completed';
                } else if (i === currentStep) {
                    stepElement.className = 'step active';
                } else {
                    stepElement.className = 'step';
                }
            }

            // Update form steps
            for (let i = 1; i <= totalSteps; i++) {
                const stepContent = document.getElementById(`step${i}Content`);
                if (i === currentStep) {
                    stepContent.className = 'form-step active';
                } else {
                    stepContent.className = 'form-step';
                }
            }

            // Update navigation buttons
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const submitBtn = document.getElementById('submitBtn');

            prevBtn.style.display = currentStep > 1 ? 'block' : 'none';
            nextBtn.style.display = currentStep < totalSteps ? 'block' : 'none';
            submitBtn.style.display = currentStep === totalSteps ? 'block' : 'none';

            // Update review content if on step 3
            if (currentStep === 3) {
                updateReviewContent();
            }
        }

        function validateCurrentStep() {
            const fields = getRequiredFieldsForStep(currentStep);
            let isValid = true;

            fields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (!field.value.trim()) {
                    field.classList.add('is-invalid');
                    isValid = false;
                } else {
                    field.classList.remove('is-invalid');
                }
            });

            // Email validation
            if (currentStep === 1) {
                const email = document.getElementById('email');
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (email.value && !emailRegex.test(email.value)) {
                    email.classList.add('is-invalid');
                    isValid = false;
                }
            }

            return isValid;
        }

        function getRequiredFieldsForStep(step) {
            switch (step) {
                case 1:
                    return ['companyName', 'contactPerson', 'email'];
                case 2:
                    return ['subject', 'details'];
                default:
                    return [];
            }
        }

        function updateReviewContent() {
            document.getElementById('reviewCompany').textContent = document.getElementById('companyName').value;
            document.getElementById('reviewContact').textContent = document.getElementById('contactPerson').value;
            document.getElementById('reviewEmail').textContent = document.getElementById('email').value;
            document.getElementById('reviewPhone').textContent = document.getElementById('phone').value || 'Not provided';
            document.getElementById('reviewSubject').textContent = document.getElementById('subject').value;
            document.getElementById('reviewBudget').textContent = document.getElementById('budget').value ? '$' + document.getElementById('budget').value : 'Not specified';
            document.getElementById('reviewStartDate').textContent = document.getElementById('preferredStartDate').value || 'Not specified';
            document.getElementById('reviewDetails').textContent = document.getElementById('details').value;
        }

        async function submitRequest() {
            if (!validateCurrentStep()) {
                return;
            }

            const requestData = {
                companyName: document.getElementById('companyName').value,
                contactPerson: document.getElementById('contactPerson').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                subject: document.getElementById('subject').value,
                details: document.getElementById('details').value,
                budget: document.getElementById('budget').value ? parseFloat(document.getElementById('budget').value) : null,
                preferredStartDate: document.getElementById('preferredStartDate').value || null
            };

            try {
                const response = await fetch('/api/custom-requests/submit', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });

                if (response.ok) {
                    const result = await response.json();
                    showSuccess(result);
                } else {
                    const error = await response.text();
                    alert('Error submitting request: ' + error);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error submitting request. Please try again.');
            }
        }

        function showSuccess(result) {
            document.getElementById('requestId').textContent = result.id;
            document.getElementById('submittedEmail').textContent = result.email;
            
            // Hide all form steps and navigation
            document.querySelectorAll('.form-step').forEach(step => step.className = 'form-step');
            document.getElementById('successContent').className = 'form-step active';
            document.getElementById('navigationButtons').style.display = 'none';
            document.querySelector('.step-indicator').style.display = 'none';
        }

        function resetForm() {
            // Reset form fields
            document.getElementById('companyName').value = '';
            document.getElementById('contactPerson').value = '';
            document.getElementById('email').value = '';
            document.getElementById('phone').value = '';
            document.getElementById('subject').value = '';
            document.getElementById('details').value = '';
            document.getElementById('budget').value = '';
            document.getElementById('preferredStartDate').value = '';

            // Reset validation states
            document.querySelectorAll('.is-invalid').forEach(field => field.classList.remove('is-invalid'));

            // Reset to step 1
            currentStep = 1;
            updateStepDisplay();

            // Show form elements
            document.getElementById('successContent').className = 'form-step';
            document.getElementById('navigationButtons').style.display = 'flex';
            document.querySelector('.step-indicator').style.display = 'flex';
        }

        // Real-time validation
        document.addEventListener('input', function(e) {
            if (e.target.classList.contains('is-invalid')) {
                e.target.classList.remove('is-invalid');
            }
        });
    </script>
</body>
</html> 